import { ScopeNotGrantedError } from '../errors.esnext';
import { useExtensionApi } from './api.esnext';
import { useSubscription } from './subscription.esnext';

/**
 * Returns the current `Customer`.
 *
 * The value is `undefined` if the buyer isn't a known customer for this shop or if they haven't logged in yet.
 */
function useCustomer() {
  const buyerIdentity = useExtensionApi().buyerIdentity;
  if (!buyerIdentity) {
    throw new ScopeNotGrantedError('Using buyer identity requires having personal customer data permissions granted to your app.');
  }
  return useSubscription(buyerIdentity.customer);
}

/**
 * Returns the email address of the buyer that is interacting with the cart.
 * The value is `undefined` if the app does not have access to customer data.
 */
function useEmail() {
  const buyerIdentity = useExtensionApi().buyerIdentity;
  if (!buyerIdentity) {
    throw new ScopeNotGrantedError('Using buyer identity requires having personal customer data permissions granted to your app.');
  }
  return useSubscription(buyerIdentity.email);
}

/**
 * Returns the phone number of the buyer that is interacting with the cart.
 * The value is `undefined` if the app does not have access to customer data.
 */
function usePhone() {
  const buyerIdentity = useExtensionApi().buyerIdentity;
  if (!buyerIdentity) {
    throw new ScopeNotGrantedError('Using buyer identity requires having personal customer data permissions granted to your app.');
  }
  return useSubscription(buyerIdentity.phone);
}

export { useCustomer, useEmail, usePhone };
